---
layout: post
title: 'Lua C API'
date: 2012-6-7
wordpress_id: 149
permalink: /blogs/149
comments: true
---
在學習用 C 寫 Lua 的模組時，最要搞清楚的就是堆疊的操作。一開始沒有把堆疊的位置搞清楚，怎麼算都覺得怪。

筆記一，堆疊的編號從 1 開始，不是從 0 開始。1 是最底下的，-1 就是最上層，-2 就是由上往下數第二層。這個部分一開始常常忘掉，範例程式整個就是覺得怪。因為一直把 -3 當成 pop 三個，這是錯的！Lua C API 裡面通常指的都是 index，pop/push 幾個要看<a title="LUA 5.2 manual" href="http://www.lua.org/manual/5.2/manual.html" target="_blank">手冊</a>。

筆記二，<a title="LUA 5.2 manual" href="http://www.lua.org/manual/5.2/manual.html" target="_blank">手冊</a>上各個函式的的 push/pop 數量要看清楚。有的函式會直接抓最上面 N 層的東西來用，這也要看清楚，呼叫函式前要先 push 進去。一開始不太習慣，後來習慣也就好了。
