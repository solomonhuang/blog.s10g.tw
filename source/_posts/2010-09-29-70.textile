---
layout: post
title: 'CODE SNIPPET – C – Preload malloc'
date: 2010-9-29
wordpress_id: 70
permalink: /blogs/70
comments: true
---
from _13h
<pre class="brush: c">void *malloc(size_t size)
{
    void *p = NULL;
    if(my_malloc == NULL)
    {
        my_malloc = (void *(*)(size_t)) dlsym(RTLD_NEXT, "malloc");
        fprintf(stderr, "[inf] hijack %s\n", __func__);
        if(count &lt; 0) count = 0;
    }
    p = my_malloc(size);
    count += size;
    fprintf(stderr, "[*] malloc %d bytes at %p, total %d\n", size, p, count);
    return p;
}{% endcodeblock %}
